#!/bin/sh

echo "Authorization on DevHub."
sfdx force:auth:web:login -d -a DevHub

while [ ! -n "$ORG_NAME"  ] 
do
	echo "Please enter a name for your scratch org:"
	read ORG_NAME
done

echo "Building your org, please wait."
sfdx force:org:create -f config/project-scratch-def.json -a ${ORG_NAME} --json

if [ "$?" = "1" ] 
then
	echo "Can't create your org."
	exit
fi

echo "Scratch org created."
echo "Deploy to scratch ${ORG_NAME}, please wait"

RES=`sfdx force:source:deploy -p force-app -u ${ORG_NAME}`

if [ "$?" = "1" ] 
then
	echo "Can't deploy code."
	exit
fi

echo "Assign permission set, please wait"

sfdx force:user:permset:assign -n Ebury_Admin -u ${ORG_NAME} --json

if [ "$?" = "1" ]
then
	echo "Can't assign the permission set."
	exit 
fi	

echo "Permission set is assigned successfully."

echo "Assign User in Queue, please wait"

sfdx force:apex:execute -f scripts/apex/assignUserInQueue.apex -u ${ORG_NAME}

if [ "$?" = "1" ]
then
	echo "Can't assign User in Queue."
	exit
fi

echo "User is assigned successfully."

sfdx force:org:open -u ${ORG_NAME} -p lightning/n/Ebury